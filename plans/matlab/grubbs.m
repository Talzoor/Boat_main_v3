clear; close all; clc;
% a = [ 14.42  14.42  14.42  14.42  14.42  14.42  14.42  14.42  14.42  14.42  14.42  14.42  14.42  14.42  14.42  14.42  14.42  14.42  14.42  14.42  14.42  14.42  14.42  14.42  14.43  14.43  14.43  14.43  14.43  14.43  14.43  14.43  14.43  14.43 179.28  14.43  14.43  14.43  14.43  14.43  14.43  14.43  14.43  14.43  14.43  14.43  14.43  14.43  14.43  14.43  14.43  14.43  14.43  14.43  14.43  14.43  14.43  14.43  14.43  14.43  14.43  14.43  14.43  14.43  14.43  14.42  14.42  14.42  14.42  14.42  14.42  14.42  14.42  14.42  14.42  14.42  14.42  14.42  14.42  14.42  14.42  14.42  14.42  14.42  14.42 180.03  14.42  14.42  14.42  14.42  14.42  14.42  14.42  14.42  14.42  14.42  14.42  14.42  14.42  14.42 ];
 
% a = [26.16  23.70  23.73  23.77  23.77  23.77  23.77  23.77  23.77  23.77  23.77  23.77  23.77  23.77  23.77  23.77  23.77  23.77  23.77  23.77  23.76  23.76  23.76  23.76  23.76  23.76  23.77  23.77  23.76  23.76  23.76  23.76  23.76  23.76  23.76  23.76  23.76  23.76  23.75  23.75  23.75  23.75  23.75  23.75  23.75  23.75  23.75  23.75  23.75  23.75  23.75  23.75  23.74  23.74  23.74  23.74  23.74  23.74  23.73  23.73  23.73  23.73  23.74  23.74  23.74  23.73  23.73  23.73  23.73  23.72  23.72  23.72  23.72  23.73  23.73  23.73  23.72  23.72  23.72  23.72  23.72  23.71  23.71  23.71  23.71  23.70  23.70  23.71  23.71  23.71  23.71  23.71  23.70  23.70  23.70  23.70  23.69  23.70  23.70  23.70 ];

% a =  [13.86  13.86  13.86  13.86  13.86  13.86  13.86  13.86  13.86  13.85  13.85  13.85  13.85  13.85  13.86  13.86  13.86  13.86  13.86  13.86  13.86  13.86  13.86  13.85  13.85  13.85  13.85  13.85  13.85  13.85  13.85  13.85  13.85  13.85  13.85  13.85  13.85  13.85  13.85  13.85  13.85  13.85  13.84  13.85  13.85  13.84  13.84  13.85  13.84  13.84  13.84  13.85  13.85  13.85  13.85  13.84  13.84  13.84  13.84  13.84  13.85  13.85  13.84  13.84  13.84  13.84  13.84  13.84  13.84  13.84  13.84  13.84  13.84  13.84  13.84  13.84  13.84  13.84  13.84  13.84  13.84  13.84  13.84  13.84  13.83  13.83  13.83  13.83  13.83  13.83  13.83  13.83  13.83  13.83  13.83  13.82  13.83  13.82  13.82  13.82]; 
%a =  [13.82  13.82  13.82  13.83  13.83  13.82  13.83  13.83  13.83  13.83  13.99  14.52  14.87  15.52  16.27  16.61  17.26  18.08  18.38  19.03  19.91  20.19  20.84  21.66  22.03  22.79  23.11  23.88  24.18  24.93  26.03  26.41  27.03  27.75  28.04  28.70  29.56  29.88  30.50  30.83  31.47  31.76  32.53  33.52  33.89  34.58  35.68  36.10  36.73  37.33  37.60  38.21  39.24  39.65  40.39  40.59  41.12  41.31  41.89  42.53  42.79  43.30  43.53  44.09  44.28  44.72  45.42  45.67  46.05  46.23  46.62  47.10  47.43  48.29  48.33  48.91  49.16  49.80  50.50  50.76  51.42  52.37  52.77  53.58  53.85  54.40  54.59  55.01  55.52  55.96  56.81  57.78  58.05  58.68  59.88  60.29  60.88  61.94  62.29  62.73]; 
% a =  [63.92  64.70  65.00  65.78  66.41  66.62  67.07  67.31  67.78  67.86  67.85  67.85  67.84  67.84  67.84  67.84  67.84  67.84  67.84  67.84  67.81  67.65  67.25  66.70  66.40  65.47  64.20  63.85  63.32  63.01  62.18  61.85  61.28  61.01  60.28  59.97  59.21  58.97  58.34  57.36   0.19  56.29  55.99  55.29  55.01  54.42  53.61  53.54  52.39  51.97  51.17  50.24  49.47  49.39  48.52  48.21  47.58  46.56  46.14  45.27  44.87  44.12  42.95  42.42  42.05  41.06  40.51  39.07  38.58  37.70  36.76  36.31  35.36  34.80  33.87  32.70  32.25  31.26  30.84  29.91  29.55  28.81  27.95  27.59  26.82  26.42  25.77  24.85  24.48  24.19  23.98  23.42  22.34  21.82  20.78  19.43  18.93  18.00  17.53  16.74]; 
a =  [15.57  14.81  13.89  13.52  12.94  12.70  12.52  12.52  12.52  12.51  12.52  12.51  12.51  12.51  12.51  12.51  12.51  12.51  12.51  12.51  12.51  12.51  12.51  12.51  12.51  12.51  12.51  12.51  12.51  12.51  12.50  12.51  12.51  12.51  12.51  12.51  12.51  12.51  12.50  12.51  12.50  12.50  12.50  12.49  12.49  12.49  12.49  12.50  12.50  12.49  12.49  12.49  12.49  12.49  12.49  12.49  12.49  12.48  12.48  12.48  12.48  12.48  12.48  12.49  12.49  12.49  12.48  12.48  12.48  12.48  12.48  12.48  12.48  12.48  12.48  12.48  12.48  12.48  12.48  12.49  12.50  12.50  12.50  12.50  12.49  12.49  12.49  12.49  12.49  12.49  12.49  12.48  12.49  12.49  12.49  12.49  12.49  12.49  12.49  12.49]; 
%a =  [12.48  12.48  12.48  12.48  12.47  12.47  12.47  12.47  12.47  12.64  15.80  17.67  18.43  18.32  16.76  16.42  16.32  18.69  19.78  21.46  22.75  23.78  26.81  28.16  31.52  36.04  36.10  35.79  34.75  32.44  31.36  27.54  25.78  20.99  19.22  16.39  14.42  12.81  12.03  12.33  13.92  19.64  21.41  24.91  27.52  27.32  23.36  20.51  18.25  18.67  25.00  25.71  23.83  20.84  15.68  15.39  12.93  12.35  10.83   9.85  10.67  20.74  24.93  30.06  33.12  35.21  39.43  39.89  38.35  36.01  31.94  36.64  39.14  40.10  37.82  35.55  32.17  28.77  27.36  24.00  22.29  18.04  14.60  14.66  19.49  26.93  28.16  30.17  32.11  33.55  36.94  37.84  38.61  38.53  35.11  31.62  30.51  28.56  26.48  25.61]; 
%a =  [20.67  19.97  19.16  18.61  16.98  16.91  16.92  16.92  16.92  16.97  17.64  22.74  24.96  28.92  30.98  34.61  35.05  33.30  29.23  26.85  26.80  28.38  30.52  34.23  37.41  38.47  41.28  42.33  44.81  47.03  48.24  50.89  51.48  51.74  51.47  46.64  40.44  38.32  34.19  32.60  28.84  23.84  22.23  19.95  18.63  16.10  14.40  14.77  15.62  20.21  24.24  25.64  26.56  28.95  29.85  33.80  36.32  36.19  33.07  28.26  26.80  23.16  21.40  17.77  16.63  14.28  16.08  19.47  25.39  28.35  29.36  32.55  36.29  40.18  42.52  42.64  42.63  41.22  36.52  35.17  31.68  29.07  23.83  18.34  17.09  17.07  18.17  23.21  25.38  30.96  37.94  40.00  43.27  44.30  45.23  45.13  44.31  40.58  38.84  34.82]; 
%a =  [26.16  23.70  23.73  23.77  23.77  23.77  23.77  23.77  23.77  23.77  23.77  23.77  23.77  23.77  23.77  23.77  23.77  23.77  23.77  23.77  23.76  23.76  23.76  23.76  23.76  23.76  23.77  23.77  23.76  23.76  23.76  23.76  23.76  23.76  23.76  23.76  23.76  23.76  23.75  23.75  23.75  23.75  23.75  23.75  23.75  23.75  23.75  23.75  23.75  23.75  23.75  23.75  23.74  23.74  23.74  23.74  23.74  23.74  23.73  23.73  23.73  23.73  23.74  23.74  23.74  23.73  23.73  23.73  23.73  23.72  23.72  23.72  23.72  23.73  23.73  23.73  23.72  23.72  23.72  23.72  23.72  23.71  23.71  23.71  23.71  23.70  23.70  23.71  23.71  23.71  23.71  23.71  23.70  23.70  23.70  23.70  23.69  23.70  23.70  23.70]; 

% fprintf("a = {"); 
% for i=1:length(a)
%     S = sprintf('%.2f ,',a(i)); 
%     fprintf(S); 
% end
% fprintf("};\n");

p = 0.05;

asiz = size(a, 2);
% ncols = prod(asiz(2:end));
lowerbound = zeros([1 asiz]);
upperbound = lowerbound;
center = lowerbound;
% aflat = a(:,:)

% tf = false(asiz)
atemp = a;
indvec = 1:size(a,2); % linear indices
indvec(isnan(atemp)) = [];
atemp(isnan(atemp)) = [];
while true
    n = length(atemp);
    
    y = sum(a) ./ asiz;
    center = y; %mean(atemp)
    
    sum_of_a=0;
    for i=1:length(atemp)
        sum_of_a = sum_of_a + atemp(i);
    end
    avg_a = sum_of_a/length(atemp);
    sum_of_xi_m_avg_a = 0;
    for i=1:length(atemp)
        sum_of_xi_m_avg_a = sum_of_xi_m_avg_a + (atemp(i)-avg_a).^2;
    end
    
%     y = sum(abs(a - sum(a)./n).^2) ./ (n-1)
    astd = sqrt(sum_of_xi_m_avg_a./(n-1))
    astd2 = std(atemp)
    
    adiff = abs(atemp - center);
    [amax, loc] = max(adiff)
    
    %t = tinv(p/(2*n),n-2);
    t=-3.6;
    threshold = ((n-1)/sqrt(n))*abs(t)/sqrt(n-2+t^2);
    
    if amax/astd > threshold
        atemp(loc) = [];
%         tf(indvec(loc)) = true;
        indvec(loc) = [];
    else
        break;
    end
end
center
lowerbound = center - astd*threshold
upperbound = center + astd*threshold
